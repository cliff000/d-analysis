<h1>対戦の記録</h1>
<p>対戦結果を保存するためのページです</p>


<!-- 日付が範囲外だと警告を出す -->
<% if @now < @kcRange[0] || @now > @kcRange[1] %>
    <script>
        alert('選択中のKCカップは時間外ですので注意してください\nKCカップは右上から切り替え出来ます');
    </script>
<% end %>

<%= form_for(@match, url:{controller:'maches', action:'create'}) do |form| %>
    <div class="form-group">
        <label>自分のデッキ</label>
        <%= form.select :mydeck, @decks,
            {selected: @defaultDeck}, {class: 'form-control'} %>
        <%= form.text_field :mydeck, :placeholder => "デッキ名", 
            :value => @defaultDeck=="自分で入力する" ? @lastData.mydeck : "", :id => 'textfield_mydeck', :class => 'form-control' %>
    </div>
    
    <div class="form-group">
        <label>自分のスキル</label>
        <%= form.select :myskill, @skills,
            {selected: @defaultSkill}, {class: 'form-control'} %>
        <%= form.text_field :myskill, :placeholder => "スキル名",
            :value => @defaultSkill=="自分で入力する" ? @lastData.myskill : "", :id => 'textfield_myskill', :class => 'form-control' %>
    </div>
    
    <div class="form-group">
        <label>相手のデッキ</label>
        <%= form.select :oppdeck, @decks, {}, {class: 'form-control'} %>
        <%= form.text_field :oppdeck, :placeholder => "デッキ名",
            :id => 'textfield_oppdeck', :class => 'form-control' %>
    </div>

    <div class="form-group">
        <label>相手のスキル</label>
        <%= form.select :oppskill, @skills, {}, {selected: "", class: 'form-control'} %>
        <%= form.text_field :oppskill, :placeholder => "スキル名",
            :id => 'textfield_oppskill', :class => 'form-control' %>
    </div>

    <div class="form-group">
        <label>勝敗</label>
        <div class="form-check">
            <label><%= form.radio_button :victory, "勝ち", :class => 'form-check-input', checked: true%>勝ち</label>
        </div>
        <div class="form-check">
            <label><%= form.radio_button :victory, "負け", :class => 'form-check-input' %>負け</label>
        </div>
    </div>

    <div class="form-group">
        DP増減値<br>
        <i id=dp_plus class="fas fa-plus"></i>
        <i id=dp_minus class="fas fa-minus"></i>
        <%= form.text_field :dpChanging , value: "1000" %>
    </div>

    <%= form.submit "送信", class:"btn btn-primary" %>
<% end %>

<script>
    //DPのプラス、マイナス切り替え
    $('#dp_minus').hide();
    $('#match_victory_勝ち').change(function(){
        $('#dp_plus').show();
        $('#dp_minus').hide();
    });
    $('#match_victory_負け').change(function(){
        $('#dp_plus').hide();
        $('#dp_minus').show();
    });

    //「自分で入力する」以外ならテキストボックスを無効化
    if($('#match_mydeck').val() != "自分で入力する"){ $('#textfield_mydeck').prop('disabled', true);  $('#textfield_mydeck').hide();}
    if($('#match_myskill').val() != "自分で入力する"){ $('#textfield_myskill').prop('disabled', true); $('#textfield_myskill').hide();}
    if($('#match_oppdeck').val() != "自分で入力する"){ $('#textfield_oppdeck').prop('disabled', true); $('#textfield_oppdeck').hide();}
    if($('#match_oppskill').val() != "自分で入力する"){ $('#textfield_oppskill').prop('disabled', true); $('#textfield_oppskill').hide();}

    $('#match_mydeck').change(function(){
        //スキルの自動入力
        $('#match_myskill').val(gon.major_skill[$('#match_mydeck').val()]);
        $('#textfield_myskill').prop('disabled', true);
        $('#textfield_myskill').hide();

        //「自分で入力する」ならテキストボックス表示
        if($('#match_mydeck').val() == "自分で入力する"){
            $('#textfield_mydeck').prop('disabled', false);
            $('#textfield_mydeck').show();
        }else{
            $('#textfield_mydeck').prop('disabled', true);
            $('#textfield_mydeck').hide();
        }
    });
    $('#match_myskill').change(function(){
        //「自分で入力する」ならテキストボックス表示
        if($('#match_myskill').val() == "自分で入力する"){
            $('#textfield_myskill').prop('disabled', false);
            $('#textfield_myskill').show();
        }else{
            $('#textfield_myskill').prop('disabled', true);
            $('#textfield_myskill').hide();
        }
    });
    $('#match_oppdeck').change(function(){
        //スキルの自動入力
        $('#match_oppskill').val(gon.major_skill[$('#match_oppdeck').val()]);

        //「自分で入力する」ならテキストボックス表示
        if($('#match_oppdeck').val() == "自分で入力する"){
            $('#textfield_oppdeck').prop('disabled', false);
            $('#textfield_oppdeck').show();
        }else{
            $('#textfield_oppdeck').prop('disabled', true);
            $('#textfield_oppdeck').hide();
        }
    });
    $('#match_oppskill').change(function(){
        //「自分で入力する」ならテキストボックス表示
        if($('#match_oppskill').val() == "自分で入力する"){
            $('#textfield_oppskill').prop('disabled', false);
            $('#textfield_oppskill').show();
        }else{
            $('#textfield_oppskill').prop('disabled', true);
            $('#textfield_oppskill').hide();
        }
    });
    
</script>

